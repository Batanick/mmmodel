<!DOCTYPE html>
<html>
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.3.0/Chart.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/4.1.2/papaparse.min.js"></script>
</head>
<body>


<p>Hello!</p>
<input type="file" id="fileSelector" multiple/>

<button id="submit" class="green" onclick="loadReport();">Parse</button>
<canvas id="usersInQueue" width="400" height="400"></canvas>

<script>
    var ctx = document.getElementById('usersInQueue').getContext('2d');
    var usersInQueueChart = new Chart(ctx, {
        type: 'line',
        data: {
            datasets: [
                {
                    data: [1,2,3,4,5],
                }
            ]
        },
        options: {
            legend: {
                display: true,
                labels: {
                    fontColor: 'rgb(255, 99, 132)'
                }
            }
        }
    });

    var loadingConfig = {
        delimiter: "",	// auto-detect
        newline: "",	// auto-detect
        header: false,
        dynamicTyping: false,
        preview: 0,
        encoding: "",
        worker: false,
        comments: false,
        step: undefined,
        complete: function (data) {
            loadData(data);
        },
        error: undefined,
        download: false,
        skipEmptyLines: false,
        chunk: undefined,
        fastMode: undefined,
        beforeFirstChunk: undefined,
        withCredentials: undefined
    };

    function loadReport() {
        var files = document.getElementById('fileSelector').files;
        if (files.length == 0) {
            alert("No reports selected");
            return;
        }

        for (var i = 0; i < files.length; i++) {
            Papa.parse(files[i], loadingConfig);
        }
    }

    function filterData(data, dataset, key, dataIndex) {
        for (var i = 0; i < data.length; i++) {
            var row = data[i];
            var tick = row[0];
            if (row [1] == key) {
                dataset.data[tick] = data[dataIndex];
            }
        }
    }

    function loadData(data) {
        var dataset = {
            label: 'Dataset ' + usersInQueueChart.data.datasets.length,
            borderColor: randomColor(0.4),
            backgroundColor: randomColor(0.5),
            pointBorderColor: randomColor(0.7),
            pointBackgroundColor: randomColor(0.5),
            pointBorderWidth: 1,
            data: []
        };
        console.log(dataset);
        filterData(data, dataset, "users_in_queue", 2);


    }


</script>
</body>
</html>
